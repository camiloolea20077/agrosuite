<!-- Header del Dashboard -->
<div class="dashboard-header mb-4">
  <div class="flex justify-content-between align-items-center">
    <div>
      <h1 class="dashboard-title m-0">
        <i class="pi pi-chart-line mr-3"></i>
        Dashboard Ganadero
      </h1>
    </div>
    <div class="flex gap-2">
      <p-button 
        icon="pi pi-refresh" 
        label="Actualizar"
        [outlined]="true"
        size="small"
        (click)="loadDashboardData()">
      </p-button>
    </div>
  </div>
</div>

<!-- Métricas Principales -->
<div class="grid mb-5">
  <!-- Total Empleados -->
  <div class="col-12 sm:col-6 lg:col-3">
    <div class="metric-card metric-employees">
      <div class="metric-content">
        <div class="metric-icon-wrapper">
          <i class="pi pi-users metric-icon"></i>
          <div class="metric-badge">
            <i class="pi pi-arrow-up text-green-500"></i>
          </div>
        </div>
        <div class="metric-info">
          <h3 class="metric-title">Empleados</h3>
          <p class="metric-value">{{ totalEmployees | number }}</p>
          <small class="metric-change">
            <i class="pi pi-arrow-up text-green-500 mr-1"></i>
            Personal activo
          </small>
        </div>
      </div>
      <div class="metric-progress">
        <div class="progress-bar" style="width: 85%"></div>
      </div>
    </div>
  </div>

  <!-- Total Nacimientos -->
  <div class="col-12 sm:col-6 lg:col-3">
    <div class="metric-card metric-births">
      <div class="metric-content">
        <div class="metric-icon-wrapper">
          <i class="pi pi-heart metric-icon"></i>
          <div class="metric-badge">
            <i class="pi pi-plus text-blue-500"></i>
          </div>
        </div>
        <div class="metric-info">
          <h3 class="metric-title">Nacimientos</h3>
          <p class="metric-value">{{ totalBirths | number }}</p>
          <small class="metric-change">
            <i class="pi pi-calendar mr-1 text-blue-500"></i>
            Este año
          </small>
        </div>
      </div>
      <div class="metric-progress">
        <div class="progress-bar" style="width: 78%"></div>
      </div>
    </div>
  </div>

  <!-- Ganado Activo -->
  <div class="col-12 sm:col-6 lg:col-3">
    <div class="metric-card metric-cattle">
      <div class="metric-content">
        <div class="metric-icon-wrapper">
          <i class="pi pi-verified metric-icon"></i>
          <div class="metric-badge">
            <i class="pi pi-check text-green-500"></i>
          </div>
        </div>
        <div class="metric-info">
          <h3 class="metric-title">Ganado Activo</h3>
          <p class="metric-value">{{ totalCattle | number }}</p>
          <small class="metric-change">
            <i class="pi pi-arrow-up text-green-500 mr-1"></i>
            En operación
          </small>
        </div>
      </div>
      <div class="metric-progress">
        <div class="progress-bar" style="width: 92%"></div>
      </div>
    </div>
  </div>

  <!-- Métrica Adicional - Próximos Destetes -->
  <div class="col-12 sm:col-6 lg:col-3">
    <div class="metric-card metric-weaning">
      <div class="metric-content">
        <div class="metric-icon-wrapper">
          <i class="pi pi-clock metric-icon"></i>
          <div class="metric-badge">
            <i class="pi pi-calendar-times text-orange-500"></i>
          </div>
        </div>
        <div class="metric-info">
          <h3 class="metric-title">Próximos Destetes</h3>
          <p class="metric-value">{{ desteteData.length | number }}</p>
          <small class="metric-change">
            <i class="pi pi-clock text-orange-500 mr-1"></i>
            Por programar
          </small>
        </div>
      </div>
      <div class="metric-progress">
        <div class="progress-bar" style="width: 68%"></div>
      </div>
    </div>
  </div>
</div>

<!-- Gráficos y Análisis -->
<div class="grid">
  <!-- Gráfico de Nacimientos por Mes -->
  <div class="col-12 lg:col-8">
    <div class="chart-card births-chart">
      <div class="chart-header">
        <div class="flex justify-content-between align-items-center mb-3">
          <div>
            <h3 class="chart-title m-0">
              <i class="pi pi-chart-bar mr-2 text-primary"></i>
              Nacimientos por Mes
            </h3>
            <p class="chart-subtitle mt-1 mb-0">
              Evolución mensual de nacimientos por sexo
            </p>
          </div>
          <div class="flex align-items-center gap-3">
            <div class="legend-item">
              <span class="legend-color male"></span>
              <small>Machos</small>
            </div>
            <div class="legend-item">
              <span class="legend-color female"></span>
              <small>Hembras</small>
            </div>
            <p-button 
              icon="pi pi-download" 
              [outlined]="true" 
              size="small"
              pTooltip="Exportar gráfico">
            </p-button>
          </div>
        </div>
      </div>
      <div class="chart-content">
        <p-chart 
          type="line" 
          [data]="barChartData" 
          [options]="lineChartOptions"
          width="100%"
          height="300">
        </p-chart>
      </div>
    </div>
  </div>

  <!-- Panel de Distribución y Estadísticas -->
  <div class="col-12 lg:col-4">
    <div class="stats-panel">
      <!-- Gráfico de Distribución -->
      <div class="distribution-card mb-4">
        <div class="chart-header mb-3">
          <h3 class="chart-title m-0">
            <i class="pi pi-chart-pie mr-2 text-primary"></i>
            Distribución por Sexo
          </h3>
          <p class="chart-subtitle mt-1 mb-0">
            Proporción de nacimientos
          </p>
        </div>
        <div class="doughnut-container">
          <p-chart 
            type="doughnut" 
            [data]="pieChartData" 
            [options]="doughnutOptions"
            width="200"
            height="200">
          </p-chart>
          <div class="doughnut-center">
            <span class="total-label">Total</span>
            <span class="total-value">{{ totalBirths }}</span>
          </div>
        </div>
      </div>

      <!-- Estadísticas Rápidas -->
      <div class="quick-stats-card">
        <h4 class="quick-stats-title mb-3">
          <i class="pi pi-info-circle mr-2"></i>
          Estadísticas Rápidas
        </h4>
        <div class="quick-stat-item">
          <span class="stat-label">Promedio mensual</span>
          <span class="stat-value">{{ getMonthlyAverage() }}</span>
        </div>
        <div class="quick-stat-item">
          <span class="stat-label">Mes más productivo</span>
          <span class="stat-value text-green-600">{{ getMostProductiveMonth() }}</span>
        </div>
        <div class="quick-stat-item">
          <span class="stat-label">Ratio Hembra/Macho</span>
          <span class="stat-value text-blue-600">{{ getGenderRatio() }}</span>
        </div>
        <div class="quick-stat-item">
          <span class="stat-label">Último nacimiento</span>
          <span class="stat-value text-purple-600">Hace 2 días</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Nueva Sección de Destetes Próximos -->
<div class="grid mt-4">
  <div class="col-12">
    <div class="destete-card">
      <div class="destete-header mb-4">
        <div class="flex justify-content-between align-items-center">
          <div>
            <h3 class="destete-title m-0">
              <i class="pi pi-clock mr-2 text-primary"></i>
              Destetes Programados
            </h3>
            <p class="destete-subtitle mt-1 mb-0">
              Próximas fechas de destete para seguimiento
            </p>
          </div>
          <div class="flex gap-2">
            <p-button 
              icon="pi pi-calendar-plus" 
              label="Programar Destete"
              [outlined]="true" 
              size="small">
            </p-button>
            <p-button 
              icon="pi pi-download" 
              [outlined]="true" 
              size="small"
              pTooltip="Exportar lista">
            </p-button>
          </div>
        </div>
      </div>
      
      <div class="destete-table">
        <p-table 
          [value]="desteteData" 
          [paginator]="true" 
          [rows]="10"
          [showCurrentPageReport]="true"
          currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros"
          [rowsPerPageOptions]="[10, 25, 50]"
          styleClass="p-datatable-sm">
          
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="numero_cria">
                <div class="flex align-items-center">
                  <span>Número de Cría</span>
                  <p-sortIcon field="numero_cria"></p-sortIcon>
                </div>
              </th>
              <th pSortableColumn="fecha_nacimiento">
                <div class="flex align-items-center">
                  <span>Fecha Nacimiento</span>
                  <p-sortIcon field="fecha_nacimiento"></p-sortIcon>
                </div>
              </th>
              <th pSortableColumn="fecha_proxima_destete">
                <div class="flex align-items-center">
                  <span>Fecha Destete</span>
                  <p-sortIcon field="fecha_proxima_destete"></p-sortIcon>
                </div>
              </th>
              <th pSortableColumn="dias_restantes">
                <div class="flex align-items-center">
                  <span>Días Restantes</span>
                  <p-sortIcon field="dias_restantes"></p-sortIcon>
                </div>
              </th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="body" let-destete>
            <tr>
              <td>
                <div class="flex align-items-center">
                  <i class="pi pi-heart text-pink-500 mr-2"></i>
                  <strong>{{ destete.numero_cria }}</strong>
                </div>
              </td>
              <td>{{ formatDate(destete.fecha_nacimiento) }}</td>
              <td>
                <div class="flex align-items-center">
                  <i class="pi pi-calendar mr-2 text-blue-500"></i>
                  {{ formatDate(destete.fecha_proxima_destete) }}
                </div>
              </td>
              <td>
                <div class="flex align-items-center">
                  <i class="pi pi-clock mr-2"></i>
                  {{ getDaysUntilWeaning(destete.dias_restantes) }}
                </div>
              </td>
              <td>
                <p-tag 
                  [value]="destete.dias_restantes < 0 ? 'Vencido' : destete.dias_restantes <= 7 ? 'Próximo' : 'Programado'"
                  [severity]="getWeaningStatus(destete.dias_restantes)">
                </p-tag>
              </td>
              <td>
                <div class="flex gap-2">
                  <p-button 
                    icon="pi pi-eye" 
                    size="small"
                    [outlined]="true"
                    pTooltip="Ver detalles">
                  </p-button>
                  <p-button 
                    icon="pi pi-calendar-plus" 
                    size="small"
                    [outlined]="true"
                    pTooltip="Programar destete">
                  </p-button>
                </div>
              </td>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="6" class="text-center p-4">
                <div class="flex flex-column align-items-center">
                  <i class="pi pi-inbox text-4xl text-300 mb-3"></i>
                  <span class="text-500">No hay destetes programados</span>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>

<!-- Sección de Actividad Reciente -->
<div class="grid mt-4">
  <div class="col-12">
    <div class="activity-card">
      <div class="activity-header mb-4">
        <h3 class="activity-title m-0">
          <i class="pi pi-history mr-2 text-primary"></i>
          Actividad Reciente
        </h3>
        <p class="activity-subtitle mt-1 mb-0">
          Últimos eventos en tu operación ganadera
        </p>
      </div>
      <div class="activity-timeline">
        <div class="timeline-item">
          <div class="timeline-marker success">
            <i class="pi pi-heart"></i>
          </div>
          <div class="timeline-content">
            <h5 class="timeline-title">Nuevo Nacimiento</h5>
            <p class="timeline-description">Vaca #A-123 dio a luz a una hembra</p>
            <small class="timeline-time">Hace 2 horas</small>
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-marker info">
            <i class="pi pi-plus"></i>
          </div>
          <div class="timeline-content">
            <h5 class="timeline-title">Ganado Registrado</h5>
            <p class="timeline-description">Se registraron 3 nuevos animales en el lote B</p>
            <small class="timeline-time">Hace 5 horas</small>
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-marker warning">
            <i class="pi pi-clock"></i>
          </div>
          <div class="timeline-content">
            <h5 class="timeline-title">Destete Próximo</h5>
            <p class="timeline-description">{{ desteteData.length > 0 ? desteteData[0].numero_cria + ' requiere destete en ' + desteteData[0].dias_restantes + ' días' : 'Sin destetes próximos' }}</p>
            <small class="timeline-time">Programado</small>
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-marker warning">
            <i class="pi pi-calendar"></i>
          </div>
          <div class="timeline-content">
            <h5 class="timeline-title">Programación de Vacunación</h5>
            <p class="timeline-description">Recordatorio: Vacunación lote C programada</p>
            <small class="timeline-time">Hace 1 día</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>