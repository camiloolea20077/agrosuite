<!-- Modal Form Template -->
<!-- Dialog mejorado para Crear/Editar Ganado -->
<p-dialog
  [(visible)]="displayModal"
  [header]="isEditMode ? 'Editar Ganado' : 'Crear Nuevo Ganado'"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  styleClass="p-fluid modern-dialog"
  [style]="{ width: '800px', maxHeight: '90vh' }"
>
  <div class="form-container">
    <form [formGroup]="frmGanado" (ngSubmit)="buildsaveCattle()">
      
      <!-- Estado del Registro -->
      <div class="field">
        <label for="activo">
          <i class="pi pi-power-off mr-2"></i>
          Estado
        </label>
        <p-dropdown
          id="activo"
          formControlName="activo"
          [options]="[
            { label: '✓ Activo', value: true },
            { label: '✗ Inactivo', value: false }
          ]"
          placeholder="Seleccione el estado"
          [class.ng-invalid]="frmGanado.get('activo')?.invalid && frmGanado.get('activo')?.touched"
          [class.ng-dirty]="frmGanado.get('activo')?.touched"
          class="form-dropdown"
        ></p-dropdown>
        <small class="p-error" *ngIf="frmGanado.get('activo')?.invalid && frmGanado.get('activo')?.touched">
          Este campo es obligatorio
        </small>
      </div>

      <!-- Información Básica - Primera Fila -->
      <div class="field-row">
        <!-- Tipo de ganado -->
        <div class="field">
          <label for="tipo_ganado">
            <i class="pi pi-tag mr-2"></i>
            Tipo de Ganado
          </label>
          <input
            type="text"
            pInputText
            id="tipo_ganado"
            formControlName="tipo_ganado"
            placeholder="Ej: Bovino, Porcino, Ovino..."
            [class.ng-invalid]="frmGanado.get('tipo_ganado')?.invalid && frmGanado.get('tipo_ganado')?.touched"
            [class.ng-dirty]="frmGanado.get('tipo_ganado')?.touched"
            class="form-input"
          />
          <small class="p-error" *ngIf="frmGanado.get('tipo_ganado')?.invalid && frmGanado.get('tipo_ganado')?.touched">
            Este campo es obligatorio
          </small>
        </div>

        <!-- Tipo específico de animal -->
        <div class="field">
          <label for="tipo_animal">
            <i class="pi pi-users mr-2"></i>
            Tipo Específico
          </label>
          <p-dropdown
            id="tipo_animal"
            [options]="tipoAnimalOptions"
            optionLabel="name"
            optionValue="value"
            formControlName="tipo_animal"
            placeholder="Seleccionar tipo específico"
            [class.ng-invalid]="frmGanado.get('tipo_animal')?.invalid && frmGanado.get('tipo_animal')?.touched"
            [class.ng-dirty]="frmGanado.get('tipo_animal')?.touched"
            class="form-dropdown"
            (onChange)="onTipoAnimalChange($event)"
          ></p-dropdown>
          <small class="p-error" *ngIf="frmGanado.get('tipo_animal')?.invalid && frmGanado.get('tipo_animal')?.touched">
            Este campo es obligatorio
          </small>
        </div>
      </div>

      <!-- Información Básica - Segunda Fila -->
      <div class="field-row">
        <!-- Número de ganado -->
        <div class="field">
          <label for="numero_ganado">
            <i class="pi pi-hashtag mr-2"></i>
            Número de Ganado
          </label>
          <input
            type="text"
            pInputText
            id="numero_ganado"
            formControlName="numero_ganado"
            placeholder="Ej: 001, A-123"
            [class.ng-invalid]="frmGanado.get('numero_ganado')?.invalid && frmGanado.get('numero_ganado')?.touched"
            [class.ng-dirty]="frmGanado.get('numero_ganado')?.touched"
            class="form-input"
          />
          <small class="p-error" *ngIf="frmGanado.get('numero_ganado')?.invalid && frmGanado.get('numero_ganado')?.touched">
            Este campo es obligatorio
          </small>
        </div>

        <!-- Sexo -->
        <div class="field">
          <label for="sexo">
            <i class="pi pi-venus-mars mr-2"></i>
            Sexo
          </label>
          <p-dropdown
            id="sexo"
            [options]="sexOptions"
            optionLabel="name"
            optionValue="value"
            formControlName="sexo"
            placeholder="Seleccionar sexo"
            [class.ng-invalid]="frmGanado.get('sexo')?.invalid && frmGanado.get('sexo')?.touched"
            [class.ng-dirty]="frmGanado.get('sexo')?.touched"
            class="form-dropdown"
          ></p-dropdown>
          <small class="p-error" *ngIf="frmGanado.get('sexo')?.invalid && frmGanado.get('sexo')?.touched">
            Este campo es obligatorio
          </small>
        </div>
      </div>

      <!-- Información Básica - Tercera Fila -->
      <div class="field-row">
        <!-- Fecha de nacimiento -->
        <div class="field">
          <label for="fecha_nacimiento">
            <i class="pi pi-calendar mr-2"></i>
            Fecha de Nacimiento
          </label>
          <p-calendar
            id="fecha_nacimiento"
            formControlName="fecha_nacimiento"
            dateFormat="yy-mm-dd"
            [showIcon]="true"
            placeholder="Seleccionar fecha"
            [class.ng-invalid]="frmGanado.get('fecha_nacimiento')?.invalid && frmGanado.get('fecha_nacimiento')?.touched"
            [class.ng-dirty]="frmGanado.get('fecha_nacimiento')?.touched"
            class="form-input"
          ></p-calendar>
          <small class="p-error" *ngIf="frmGanado.get('fecha_nacimiento')?.invalid && frmGanado.get('fecha_nacimiento')?.touched">
            Este campo es obligatorio
          </small>
        </div>

        <!-- Lote ganado -->
        <div class="field">
          <label for="lote_ganado">
            <i class="pi pi-th-large mr-2"></i>
            Lote
          </label>
          <input
            type="text"
            pInputText
            id="lote_ganado"
            formControlName="lote_ganado"
            placeholder="Ej: Lote A, Sector 1"
            [class.ng-invalid]="frmGanado.get('lote_ganado')?.invalid && frmGanado.get('lote_ganado')?.touched"
            [class.ng-dirty]="frmGanado.get('lote_ganado')?.touched"
            class="form-input"
          />
          <small class="p-error" *ngIf="frmGanado.get('lote_ganado')?.invalid && frmGanado.get('lote_ganado')?.touched">
            Este campo es obligatorio
          </small>
        </div>
      </div>

      <!-- Características Físicas -->
      <div class="field-row">
        <!-- Peso -->
        <div class="field">
          <label for="peso">
            <i class="pi pi-chart-line mr-2"></i>
            Peso (kg)
          </label>
          <p-inputNumber
            id="peso"
            formControlName="peso"
            mode="decimal"
            [minFractionDigits]="0"
            [maxFractionDigits]="2"
            suffix=" kg"
            placeholder="0.00"
            [class.ng-invalid]="frmGanado.get('peso')?.invalid && frmGanado.get('peso')?.touched"
            [class.ng-dirty]="frmGanado.get('peso')?.touched"
            class="form-input"
          ></p-inputNumber>
          <small class="p-error" *ngIf="frmGanado.get('peso')?.invalid && frmGanado.get('peso')?.touched">
            Este campo es obligatorio
          </small>
        </div>

        <!-- Color -->
        <div class="field">
          <label for="color">
            <i class="pi pi-palette mr-2"></i>
            Color
          </label>
          <input
            type="text"
            pInputText
            id="color"
            formControlName="color"
            placeholder="Ej: Negro, Blanco, Marrón"
            [class.ng-invalid]="frmGanado.get('color')?.invalid && frmGanado.get('color')?.touched"
            [class.ng-dirty]="frmGanado.get('color')?.touched"
            class="form-input"
          />
          <small class="p-error" *ngIf="frmGanado.get('color')?.invalid && frmGanado.get('color')?.touched">
            Este campo es obligatorio
          </small>
        </div>
      </div>

      <!-- Información Reproductiva (Solo para vacas) -->
      <div class="field-row" *ngIf="showPregnancySection">
        <!-- Estado de embarazo -->
        <div class="field">
          <label for="embarazada">
            <i class="pi pi-heart mr-2"></i>
            Estado de Embarazo
          </label>
          <p-dropdown
            id="embarazada"
            [options]="embarazadaOptions"
            optionLabel="name"
            optionValue="value"
            formControlName="embarazada"
            placeholder="Seleccionar estado"
            class="form-dropdown"
            (onChange)="onEmbarazadaChange($event)"
          ></p-dropdown>
        </div>

        <!-- Fecha de embarazo (solo si está embarazada) -->
        <div class="field" *ngIf="showPregnancyDate">
          <label for="fecha_embarazo" data-optional>
            <i class="pi pi-calendar-plus mr-2"></i>
            Fecha de Embarazo
            <span class="optional-text">(opcional)</span>
          </label>
          <p-calendar
            id="fecha_embarazo"
            formControlName="fecha_embarazo"
            dateFormat="yy-mm-dd"
            [showIcon]="true"
            placeholder="Seleccionar fecha de embarazo"
            [maxDate]="today"
            class="form-input"
          ></p-calendar>
          <small class="text-muted block mt-1">
            <i class="pi pi-info-circle mr-1"></i>
            Fecha cuando se confirmó el embarazo
          </small>
        </div>
      </div>

      <!-- Observaciones -->
      <div class="field">
        <label for="observaciones" data-optional>
          <i class="pi pi-file-edit mr-2"></i>
          Observaciones
          <span class="optional-text">(opcional)</span>
        </label>
        <textarea
          pInputTextarea
          id="observaciones"
          formControlName="observaciones"
          rows="3"
          placeholder="Ingrese observaciones adicionales sobre el ganado..."
          [autoResize]="true"
          class="form-textarea"
        ></textarea>
      </div>
    </form>
  </div>

  <!-- Footer del dialog -->
  <ng-template pTemplate="footer">
    <div class="dialog-footer">
      <p-button
        label="Cancelar"
        icon="pi pi-times"
        severity="secondary"
        (onClick)="closeModal()"
        [disabled]="isSubmitting"
        class="cancel-button"
      ></p-button>
      <p-button
        label="Limpiar"
        icon="pi pi-refresh"
        severity="warning"
        [outlined]="true"
        (onClick)="resetForm()"
        [disabled]="isSubmitting"
        class="reset-button"
      ></p-button>
      <p-button
        [label]="isEditMode ? 'Actualizar' : 'Guardar'"
        [icon]="isEditMode ? 'pi pi-check' : 'pi pi-save'"
        (onClick)="buildsaveCattle()"
        [loading]="isSubmitting"
        [disabled]="frmGanado.invalid"
        class="save-button"
      ></p-button>
    </div>
  </ng-template>
</p-dialog>

<p-toast></p-toast>