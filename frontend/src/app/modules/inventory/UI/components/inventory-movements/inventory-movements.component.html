<div class="inventory-movements">
  <!-- Enhanced Header -->
  <div class="card mb-4 border-0 shadow-3">
    <div
      class="card-header p-4"
      style="
        background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
        border-radius: 16px 16px 0 0;
      "
    >
      <div
        class="flex flex-column md:flex-row md:justify-content-between md:align-items-center"
      >
        <div class="flex align-items-center mb-3 md:mb-0">
          <div
            class="flex align-items-center justify-content-center border-circle bg-white-alpha-20"
            style="width: 60px; height: 60px; margin-right: 1rem"
          >
            <i class="pi pi-arrows-alt text-white text-3xl"></i>
          </div>
          <div>
            <h2 class="text-white text-3xl font-bold m-0 mb-1">
              Movimientos de Inventario
            </h2>
            <p class="text-white-alpha-70 m-0">
              Gestiona todos los movimientos de stock
            </p>
          </div>
        </div>

        <div class="flex gap-2">
          <p-button
            label="Nuevo Movimiento"
            icon="pi pi-plus"
            class="p-button-success p-button-raised p-button-rounded"
            (onClick)="showAddDialog()"
            styleClass="rounded-button"
          >
          </p-button>
        </div>
      </div>
    </div>

<!-- Filtros -->
<!-- Filtros -->
<div class="card-body p-4">
  <div class="filter-section mb-4">
    <div class="grid">
      <!-- Insumo -->
      <div class="col-12 md:col-3">
        <label class="font-semibold block mb-2 text-900">
          <i class="pi pi-box mr-1 text-blue-600"></i>Insumo
        </label>
        <p-dropdown
          [(ngModel)]="selectedInventoryId"
          [ngModelOptions]="{ standalone: true }"
          [options]="inventoryList"
          optionLabel="nombre"
          optionValue="id"
          placeholder="Seleccione un insumo"
          [showClear]="true"
          [filter]="true"
          appendTo="body"
          filterBy="nombre"
          (onChange)="onFilterChange()"
          class="w-full modern-dropdown">
        </p-dropdown>
      </div>

      <!-- Tipo de Movimiento -->
      <div class="col-12 md:col-3">
        <label class="font-semibold block mb-2 text-900">
          <i class="pi pi-tags mr-1 text-blue-600"></i>Tipo de Movimiento
        </label>
        <p-dropdown
          [(ngModel)]="selectedType"
          [ngModelOptions]="{ standalone: true }"
          [options]="tiposMovimientos"
          optionLabel="nombre"
          optionValue="id"
          placeholder="Todos los tipos"
          [showClear]="true"
          (onChange)="onFilterChange()"
          appendTo="body"
          class="w-full modern-dropdown">
        </p-dropdown>
      </div>

      <!-- Fecha Inicio -->
      <div class="col-12 md:col-2">
        <label class="font-semibold block mb-2 text-900">
          <i class="pi pi-calendar mr-1 text-blue-600"></i>Fecha Inicio
        </label>
        <p-calendar
          [(ngModel)]="startDate"
          [ngModelOptions]="{ standalone: true }"
          appendTo="body"
          dateFormat="dd/mm/yy"
          placeholder="Fecha inicio"
          [showButtonBar]="true"
          (ngModelChange)="onFilterChange()"
          class="w-full modern-calendar">
        </p-calendar>
      </div>

      <!-- Fecha Fin -->
      <div class="col-12 md:col-2">
        <label class="font-semibold block mb-2 text-900">
          <i class="pi pi-calendar-plus mr-1 text-blue-600"></i>Fecha Fin
        </label>
        <p-calendar
          [(ngModel)]="endDate"
          [ngModelOptions]="{ standalone: true }"
          appendTo="body"
          dateFormat="dd/mm/yy"
          placeholder="Fecha fin"
          [showButtonBar]="true"
          (ngModelChange)="onFilterChange()"
          class="w-full modern-calendar">
        </p-calendar>
      </div>

      <!-- Botón limpiar -->
      <div class="col-12 md:col-2 flex align-items-end">
        <p-button
          label="Limpiar"
          icon="pi pi-filter-slash"
          class="p-button-outlined p-button-danger w-full p-button-rounded"
          (onClick)="clearFilters()">
        </p-button>
      </div>
    </div>
  </div>
</div>

  </div>

  <!-- Enhanced Tabs -->
  <div class="card border-0 shadow-2 modern-card">
    <p-tabView (onChange)="onTabChange($event)" class="modern-tabs">
      <!-- All Movements Tab -->
      <p-tabPanel header="Todos los Movimientos" leftIcon="pi pi-list">
        <div class="table-container">
          <p-table
            [value]="movements"
            [loading]="isLoading"
            styleClass="p-datatable-gridlines p-datatable-striped modern-table"
            [tableStyle]="{ 'min-width': '90rem' }"
            [sortField]="'fechaMovimiento'"
            [sortOrder]="-1"
            [rows]="10"
            [paginator]="true"
            [rowsPerPageOptions]="[10, 25, 50]"
            [showCurrentPageReport]="true"
            currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} movimientos"
          >
            <ng-template pTemplate="header">
              <tr>
                <th style="width: 3rem">
                  <div class="flex align-items-center justify-content-center">
                    <i class="pi pi-hashtag text-blue-600"></i>
                  </div>
                </th>
                <th pSortableColumn="fechaMovimiento" style="min-width: 10rem">
                  <div class="flex align-items-center">
                    <i class="pi pi-calendar mr-2 text-blue-600"></i>
                    <span class="font-semibold">Fecha</span>
                    <p-sortIcon field="fechaMovimiento"></p-sortIcon>
                  </div>
                </th>
                <th style="min-width: 15rem">
                  <div class="flex align-items-center">
                    <i class="pi pi-box mr-2 text-blue-600"></i>
                    <span class="font-semibold">Insumo</span>
                  </div>
                </th>
                <th style="min-width: 12rem">
                  <div class="flex align-items-center">
                    <i class="pi pi-tags mr-2 text-blue-600"></i>
                    <span class="font-semibold">Tipo de Movimiento</span>
                  </div>
                </th>
                <th pSortableColumn="cantidad" style="min-width: 10rem">
                  <div class="flex align-items-center">
                    <i class="pi pi-calculator mr-2 text-blue-600"></i>
                    <span class="font-semibold">Cantidad</span>
                    <p-sortIcon field="cantidad"></p-sortIcon>
                  </div>
                </th>
                <th style="min-width: 10rem">
                  <div class="flex align-items-center">
                    <i class="pi pi-file mr-2 text-blue-600"></i>
                    <span class="font-semibold">Documento</span>
                  </div>
                </th>
                <th style="min-width: 12rem">
                  <div class="flex align-items-center">
                    <i class="pi pi-info-circle mr-2 text-blue-600"></i>
                    <span class="font-semibold">Estado</span>
                  </div>
                </th>
                <th style="min-width: 12rem">
                  <div class="flex align-items-center">
                    <i class="pi pi-comment mr-2 text-blue-600"></i>
                    <span class="font-semibold">Observaciones</span>
                  </div>
                </th>
                <th style="width: 12rem">
                  <div class="flex align-items-center justify-content-center">
                    <i class="pi pi-cog mr-2 text-blue-600"></i>
                    <span class="font-semibold">Acciones</span>
                  </div>
                </th>
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-movement let-rowIndex="rowIndex">
              <tr class="hover:bg-blue-50 transition-colors">
                <td>
                  <div class="flex align-items-center justify-content-center">
                    <span
                      class="text-sm text-600 bg-blue-100 border-round px-2 py-1 font-semibold"
                      style="border-radius: 12px;"
                      >{{ rowIndex + 1 }}</span
                    >
                  </div>
                </td>
                <td>
                  <div class="flex flex-column">
                    <div class="flex align-items-center mb-1">
                      <i class="pi pi-calendar text-blue-600 mr-2"></i>
                      <span class="font-medium text-900">{{
                        formatDate(movement.fechaMovimiento)
                      }}</span>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="flex flex-column">
                    <div class="flex align-items-center mb-1">
                      <div
                        class="w-2rem h-2rem bg-blue-100 border-circle flex align-items-center justify-content-center mr-2"
                      >
                        <i class="pi pi-box text-blue-600 text-sm"></i>
                      </div>
                      <span class="font-medium text-900">
                        {{ getInventoryName(movement.inventoryId) }}
                      </span>
                    </div>
                    <small class="text-500 ml-6" *ngIf="movement.numeroDocumento">
                      <i class="pi pi-file-o mr-1"></i>
                      Doc: {{ movement.numeroDocumento  }}
                    </small>
                  </div>
                </td>
                <td>
                  <div class="flex flex-column gap-1">
                    <p-tag
                      [value]="getTipoMovimientoName(movement.tipoMovimientoId)"
                      [severity]="
                        getMovementTypeSeverity(movement.tipoMovimientoId)
                      "
                      class="text-xs font-semibold modern-tag"
                    >
                    </p-tag>
                  </div>
                </td>
                <td>
                  <div class="flex align-items-center">
                    <span class="font-bold text-2xl mr-2 text-900">{{
                      movement.cantidad
                    }}</span>
                  </div>
                </td>
                <td>
                  <div
                    class="flex align-items-center"
                    *ngIf="movement.numeroDocumento ; else noDoc"
                  >
                    <i class="pi pi-file text-blue-600 mr-2"></i>
                    <span class="text-900">{{ movement.numeroDocumento  }}</span>
                  </div>
                  <ng-template #noDoc>
                    <div class="flex align-items-center text-500">
                      <i class="pi pi-minus-circle mr-2"></i>
                      <span class="text-sm">Sin documento</span>
                    </div>
                  </ng-template>
                </td>
                <td>
                  <div class="flex flex-column gap-1">
                    <p-tag
                      [value]="getEstadoMovimientoName(movement.estadoId)"
                      severity="info"
                      class="text-xs font-semibold modern-tag"
                    >
                    </p-tag>
                  </div>
                </td>
                <td>
                  <div *ngIf="movement.observaciones; else noObs">
                    <span
                      class="text-sm bg-gray-100 px-3 py-2 border-round block observation-badge"
                      [pTooltip]="movement.observaciones"
                    >
                      <i class="pi pi-comment mr-1 text-gray-600"></i>
                      {{
                        movement.observaciones.length > 30
                          ? (movement.observaciones | slice : 0 : 30) + "..."
                          : movement.observaciones
                      }}
                    </span>
                  </div>
                  <ng-template #noObs>
                    <span class="text-500 text-sm">
                      <i class="pi pi-minus-circle mr-1"></i>
                      Sin observaciones
                    </span>
                  </ng-template>
                </td>
                <td>
                  <div class="flex gap-1">
                    <p-button
                      icon="pi pi-eye"
                      class="p-button-text p-button-rounded p-button-info"
                      size="small"
                      pTooltip="Ver detalles"
                      (onClick)="showEditDialog(movement)"
                      styleClass="action-button info-button"
                    >
                    </p-button>

                    <p-button
                      icon="pi pi-pencil"
                      class="p-button-text p-button-rounded p-button-warning"
                      size="small"
                      pTooltip="Editar"
                      [disabled]="movement.estado === 'Cerrado'"
                      (onClick)="showEditDialog(movement)"
                      styleClass="action-button warning-button"
                    >
                    </p-button>

                    <p-button
                      icon="pi pi-trash"
                      class="p-button-text p-button-rounded p-button-danger"
                      size="small"
                      pTooltip="Eliminar"
                      [disabled]="movement.estado === 'Cerrado'"
                      (onClick)="confirmDelete(movement)"
                      styleClass="action-button danger-button"
                    >
                    </p-button>
                  </div>
                </td>
              </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="9" class="text-center p-6">
                  <div
                    class="flex flex-column align-items-center justify-content-center"
                  >
                    <div
                      class="w-6rem h-6rem bg-blue-100 border-circle flex align-items-center justify-content-center mb-4"
                    >
                      <i class="pi pi-inbox text-4xl text-blue-400"></i>
                    </div>
                    <h3 class="text-900 font-semibold mb-2">
                      No se encontraron movimientos
                    </h3>
                    <p class="text-500 mb-4">
                      Ajusta los filtros o crea el primer movimiento
                    </p>
                    <p-button
                      label="Crear Primer Movimiento"
                      icon="pi pi-plus"
                      class="p-button-primary p-button-rounded"
                      (onClick)="showAddDialog()"
                      styleClass="rounded-button"
                    >
                    </p-button>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </p-tabPanel>

      <!-- Pending Approvals Tab -->
      <p-tabPanel header="Pendientes de Aprobación" leftIcon="pi pi-clock">
        <div class="pending-approvals-container">
          <div *ngIf="pendingApprovals.length === 0" class="text-center p-6">
            <div
              class="flex flex-column align-items-center justify-content-center"
            >
              <div
                class="w-6rem h-6rem bg-green-100 border-circle flex align-items-center justify-content-center mb-4"
              >
                <i class="pi pi-check-circle text-4xl text-green-500"></i>
              </div>
              <h3 class="text-900 font-semibold mb-2">¡Excelente trabajo!</h3>
              <p class="text-500 mb-4">
                No hay movimientos pendientes de aprobación
              </p>
              <span
                class="bg-green-100 text-green-800 px-3 py-2 border-round font-semibold"
                style="border-radius: 12px;"
                >Todo al día</span
              >
            </div>
          </div>

          <p-table
            *ngIf="pendingApprovals.length > 0"
            [value]="pendingApprovals"
            [responsive]="true"
            styleClass="p-datatable-gridlines p-datatable-striped modern-table"
            [tableStyle]="{ 'min-width': '80rem' }"
            [rows]="10"
            [paginator]="true"
          >
            <ng-template pTemplate="header">
              <tr>
                <th style="width: 3rem">
                  <i class="pi pi-hashtag text-orange-500"></i>
                </th>
                <th style="min-width: 10rem">
                  <div class="flex align-items-center">
                    <i class="pi pi-calendar mr-2 text-orange-500"></i>
                    <span class="font-semibold">Fecha</span>
                  </div>
                </th>
                <th style="min-width: 15rem">
                  <div class="flex align-items-center">
                    <i class="pi pi-box mr-2 text-orange-500"></i>
                    <span class="font-semibold">Insumo</span>
                  </div>
                </th>
                <th style="min-width: 12rem">
                  <div class="flex align-items-center">
                    <i class="pi pi-tags mr-2 text-orange-500"></i>
                    <span class="font-semibold">Tipo</span>
                  </div>
                </th>
                <th style="min-width: 10rem">
                  <div class="flex align-items-center">
                    <i class="pi pi-calculator mr-2 text-orange-500"></i>
                    <span class="font-semibold">Cantidad</span>
                  </div>
                </th>
                <th style="min-width: 12rem">
                  <div class="flex align-items-center">
                    <i class="pi pi-comment mr-2 text-orange-500"></i>
                    <span class="font-semibold">Observaciones</span>
                  </div>
                </th>
                <th style="width: 15rem">
                  <div class="flex align-items-center">
                    <i class="pi pi-cog mr-2 text-orange-500"></i>
                    <span class="font-semibold">Acciones</span>
                  </div>
                </th>
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-movement let-rowIndex="rowIndex">
              <tr class="hover:bg-orange-50 transition-colors">
                <td>
                  <span
                    class="bg-orange-100 text-orange-800 px-2 py-1 border-round font-semibold text-sm"
                    style="border-radius: 12px;"
                    >{{ rowIndex + 1 }}</span
                  >
                </td>
                <td>
                  <div class="flex align-items-center">
                    <i class="pi pi-clock text-orange-500 mr-2"></i>
                    <span class="font-medium">{{
                      formatDate(movement.fechaMovimiento)
                    }}</span>
                  </div>
                </td>
                <td>
                  <div class="flex align-items-center">
                    <div
                      class="w-2rem h-2rem bg-orange-100 border-circle flex align-items-center justify-content-center mr-2"
                    >
                      <i class="pi pi-box text-orange-600 text-sm"></i>
                    </div>
                    <span class="font-medium">{{
                      getInventoryName(movement.inventoryId)
                    }}</span>
                  </div>
                </td>
                <td>
                  <p-tag
                    [value]="getMovementTypeLabel(movement.tipoMovimientoId)"
                    [severity]="
                      getMovementTypeSeverity(movement.tipoMovimientoId)
                    "
                    class="font-semibold modern-tag"
                  >
                  </p-tag>
                </td>
                <td>
                  <div class="flex align-items-center">
                    <span class="font-bold text-xl mr-2">{{
                      movement.cantidad
                    }}</span>
                    <span
                      class="text-500 bg-gray-100 px-2 py-1 border-round text-sm"
                      style="border-radius: 8px;"
                      >{{ movement.unidadMedida }}</span
                    >
                  </div>
                </td>
                <td>
                  <div class="bg-gray-100 px-3 py-2 border-round observation-badge">
                    <i class="pi pi-comment mr-1 text-gray-600"></i>
                    <span class="text-sm">{{
                      movement.observaciones || "Sin observaciones"
                    }}</span>
                  </div>
                </td>
                <td>
                  <div class="flex gap-2">
                    <p-button
                      label="Aprobar"
                      icon="pi pi-check"
                      class="p-button-success p-button-sm p-button-rounded"
                      size="small"
                      (onClick)="approveMovement(movement)"
                      styleClass="rounded-button approval-button"
                    >
                    </p-button>

                    <p-button
                      label="Rechazar"
                      icon="pi pi-times"
                      class="p-button-danger p-button-outlined p-button-sm p-button-rounded"
                      size="small"
                      (onClick)="rejectMovement(movement)"
                      styleClass="rounded-button-outlined rejection-button"
                    >
                    </p-button>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>

  <!-- Enhanced Movement Form Dialog -->
  <p-dialog
    [header]="isEditing ? 'Editar Movimiento' : 'Nuevo Movimiento'"
    [(visible)]="isFormVisible"
    [modal]="true"
    [style]="{ width: '90vw', maxWidth: '800px' }"
    [closable]="!isLoading"
    [dismissableMask]="!isLoading"
    styleClass="p-fluid modern-dialog"
  >
    <form [formGroup]="movementForm" (ngSubmit)="onSubmit()">
      <div class="grid">
        <!-- Basic Information -->
        <div class="col-12">
          <div class="bg-blue-50 p-3 border-round mb-4 info-section">
            <h4 class="text-blue-700 mb-2 flex align-items-center">
              <i class="pi pi-info-circle mr-2"></i>
              Información del Movimiento
            </h4>
            <p class="text-blue-600 m-0 text-sm">
              Complete los datos básicos del movimiento de inventario
            </p>
          </div>
        </div>

        <div class="col-12 md:col-6">
          <label for="inventoryId" class="font-semibold mb-2 block">
            <i class="pi pi-box mr-1 text-blue-600"></i>
            Insumo *
          </label>
          <p-dropdown
            id="inventoryId"
            formControlName="inventoryId"
            [options]="inventoryList"
            optionLabel="nombre"
            optionValue="id"
            placeholder="Seleccione un insumo"
            [showClear]="true"
            [filter]="true"
            appendTo="body"
            filterBy="nombre"
            (onChange)="onInventoryChange($event.value)"
            [class.ng-invalid]="isFieldInvalid('inventoryId')"
            class="w-full modern-dropdown"
          >
          </p-dropdown>
          <small class="p-error" *ngIf="isFieldInvalid('inventoryId')">
            {{ getFieldError("inventoryId") }}
          </small>
        </div>

        <div class="col-12 md:col-6">
          <label for="tipoMovimientoId" class="font-semibold mb-2 block">
            <i class="pi pi-tags mr-1 text-blue-600"></i>
            Tipo de Movimiento *
          </label>
          <p-dropdown
            id="tipoMovimientoId"
            formControlName="tipoMovimientoId"
            [options]="tiposMovimientos"
            optionLabel="nombre"
            optionValue="id"
            [class.ng-invalid]="isFieldInvalid('tipoMovimientoId')"
            placeholder="Seleccione tipo"
            class="w-full modern-dropdown"
          >
          </p-dropdown>
          <small class="p-error" *ngIf="isFieldInvalid('tipoMovimientoId')">
            {{ getFieldError("tipoMovimientoId") }}
          </small>
        </div>

        <div class="col-12 md:col-4">
          <label for="cantidad" class="font-semibold mb-2 block">
            <i class="pi pi-calculator mr-1 text-blue-600"></i>
            Cantidad *
          </label>
          <p-inputNumber
            id="cantidad"
            formControlName="cantidad"
            [class.ng-invalid]="isFieldInvalid('cantidad')"
            mode="decimal"
            [minFractionDigits]="2"
            [maxFractionDigits]="2"
            [min]="0"
            class="w-full modern-input"
          >
          </p-inputNumber>
          <small class="p-error" *ngIf="isFieldInvalid('cantidad')">
            {{ getFieldError("cantidad") }}
          </small>
        </div>

        <div class="col-12 md:col-4">
          <label for="unidadMedida" class="font-semibold mb-2 block">
            <i class="pi pi-tag mr-1 text-blue-600"></i>
            Unidad de Medida *
          </label>
          <p-dropdown
            id="unidadMedida"
            [options]="availableUnits"
            formControlName="unidadMedida"
            optionLabel="label"
            optionValue="value"
            placeholder="Unidad se establece automáticamente"
            [class.ng-invalid]="isFieldInvalid('unidadMedida')"
            class="w-full"
            [filter]="true"
            filterBy="label"
            [showClear]="true"
            [disabled]="true"
            pTooltip="La unidad de medida se establece automáticamente según el insumo seleccionado"
          >
          </p-dropdown>
          <small class="p-error" *ngIf="isFieldInvalid('unidadMedida')">
            {{ getFieldError("unidadMedida") }}
          </small>
        </div>

        <div class="col-12 md:col-4">
          <label for="estadoId" class="font-semibold mb-2 block">
            <i class="pi pi-info-circle mr-1 text-blue-600"></i>
            Estado *
          </label>
          <p-dropdown
            id="estadoId"
            formControlName="estadoId"
            [options]="estadosMovimientos"
            optionLabel="nombre"
            optionValue="id"
            [class.ng-invalid]="isFieldInvalid('estadoId')"
            placeholder="Seleccione estado"
            class="w-full modern-dropdown"
          >
          </p-dropdown>
          <small class="p-error" *ngIf="isFieldInvalid('estadoId')">
            {{ getFieldError("estadoId") }}
          </small>
        </div>

        <!-- Dates and Document -->
        <div class="col-12">
          <div class="bg-green-50 p-3 border-round mb-4 mt-4 info-section">
            <h4 class="text-green-700 mb-2 flex align-items-center">
              <i class="pi pi-calendar mr-2"></i>
              Fechas y Documento
            </h4>
            <p class="text-green-600 m-0 text-sm">
              Configure las fechas y documentos relacionados
            </p>
          </div>
        </div>

        <div class="col-12 md:col-6">
          <label for="fechaMovimiento" class="font-semibold mb-2 block">
            <i class="pi pi-calendar mr-1 text-blue-600"></i>
            Fecha de Movimiento *
          </label>
          <p-calendar
            id="fechaMovimiento"
            formControlName="fechaMovimiento"
            [class.ng-invalid]="isFieldInvalid('fechaMovimiento')"
            dateFormat="dd/mm/yy"
            [showTime]="true"
            appendTo="body"
            [showIcon]="true"
            class="w-full modern-calendar"
          >
          </p-calendar>
          <small class="p-error" *ngIf="isFieldInvalid('fechaMovimiento')">
            {{ getFieldError("fechaMovimiento") }}
          </small>
        </div>

        <div class="col-12 md:col-6">
          <label for="fechaProgramada" class="font-semibold mb-2 block">
            <i class="pi pi-calendar-plus mr-1 text-blue-600"></i>
            Fecha Programada
          </label>
          <p-calendar
            id="fechaProgramada"
            formControlName="fechaProgramada"
            dateFormat="dd/mm/yy"
            [showTime]="true"
            [showIcon]="true"
            class="w-full modern-calendar"
          >
          </p-calendar>
        </div>

        <div class="col-12 md:col-6">
          <label for="numeroDocumento" class="font-semibold mb-2 block">
            <i class="pi pi-file mr-1 text-blue-600"></i>
            Número de Documento
          </label>
          <input
            id="numeroDocumento"
            type="text"
            pInputText
            formControlName="numeroDocumento"
            placeholder="Ej: FAC-001, GR-123"
            class="w-full modern-input"
          />
        </div>

        <div class="col-12 md:col-6">
          <label for="employeeId" class="font-semibold mb-2 block">
            <i class="pi pi-user mr-1 text-blue-600"></i>
            Empleado
          </label>
          <p-dropdown
              id="typeFilter"
              appendTo="body"
              formControlName="employeeId"
              [options]="employeesList"
              optionLabel="nombre"
              optionValue="id"
              placeholder="Empleados"
              [showClear]="true"
              class="w-full modern-dropdown"
            >
            </p-dropdown>
        </div>

        <!-- Locations -->
        <div class="col-12">
          <div class="bg-purple-50 p-3 border-round mb-4 mt-4 info-section">
            <h4 class="text-purple-700 mb-2 flex align-items-center">
              <i class="pi pi-map-marker mr-2"></i>
              Ubicaciones
            </h4>
            <p class="text-purple-600 m-0 text-sm">
              Especifique las ubicaciones de origen y destino
            </p>
          </div>
        </div>

        <div class="col-12 md:col-6">
          <label for="ubicacionOrigen" class="font-semibold mb-2 block">
            <i class="pi pi-sign-in mr-1 text-blue-600"></i>
            Ubicación Origen
          </label>
          <input
            id="ubicacionOrigen"
            type="text"
            pInputText
            formControlName="ubicacionOrigen"
            placeholder="Ej: Almacén Principal"
            class="w-full modern-input"
          />
        </div>

        <div class="col-12 md:col-6">
          <label for="ubicacionDestino" class="font-semibold mb-2 block">
            <i class="pi pi-sign-out mr-1 text-blue-600"></i>
            Ubicación Destino
          </label>
          <input
            id="ubicacionDestino"
            type="text"
            pInputText
            formControlName="ubicacionDestino"
            placeholder="Ej: Campo Norte"
            class="w-full modern-input"
          />
        </div>

        <!-- Options and Notes -->
        <div class="col-12">
          <div class="bg-orange-50 p-3 border-round mb-4 mt-4 info-section">
            <h4 class="text-orange-700 mb-2 flex align-items-center">
              <i class="pi pi-cog mr-2"></i>
              Opciones y Notas
            </h4>
            <p class="text-orange-600 m-0 text-sm">
              Configure opciones adicionales y agregue notas
            </p>
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field-checkbox bg-blue-50 p-3 border-round modern-checkbox">
            <p-checkbox
              id="requiereAprobacion"
              formControlName="requiereAprobacion"
              [binary]="true"
            >
            </p-checkbox>
            <label for="requiereAprobacion" class="ml-2 font-semibold">
              <i class="pi pi-shield text-blue-500 mr-1"></i>
              Requiere aprobación
            </label>
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field-checkbox bg-gray-50 p-3 border-round modern-checkbox">
            <p-checkbox
              id="esAutomatico"
              formControlName="esAutomatico"
              [binary]="true"
            >
            </p-checkbox>
            <label for="esAutomatico" class="ml-2 font-semibold">
              <i class="pi pi-cog text-gray-500 mr-1"></i>
              Es automático
            </label>
          </div>
        </div>

        <div class="col-12">
          <label for="observaciones" class="font-semibold mb-2 block">
            <i class="pi pi-comment mr-1 text-blue-600"></i>
            Observaciones
          </label>
          <textarea
            id="observaciones"
            pInputTextarea
            formControlName="observaciones"
            rows="3"
            placeholder="Observaciones del movimiento"
            class="w-full modern-textarea"
          >
          </textarea>
        </div>

        <div class="col-12">
          <label for="notas" class="font-semibold mb-2 block">
            <i class="pi pi-bookmark mr-1 text-blue-600"></i>
            Notas
          </label>
          <textarea
            id="notas"
            pInputTextarea
            formControlName="notas"
            rows="2"
            placeholder="Notas adicionales"
            class="w-full modern-textarea"
          >
          </textarea>
        </div>
      </div>
    </form>

    <ng-template pTemplate="footer">
      <div
        class="flex justify-content-end gap-2 pt-4 border-top-1 surface-border"
      >
        <p-button
          label="Cancelar"
          icon="pi pi-times"
          class="p-button-text p-button-secondary p-button-rounded"
          [disabled]="isLoading"
          (onClick)="hideDialog()"
          styleClass="rounded-button-outlined secondary-button"
        >
        </p-button>

        <p-button
          [label]="isEditing ? 'Actualizar Movimiento' : 'Crear Movimiento'"
          [icon]="isLoading ? 'pi pi-spin pi-spinner' : 'pi pi-check'"
          class="p-button-primary p-button-rounded"
          [loading]="isLoading"
          [disabled]="movementForm.invalid"
          (onClick)="onSubmit()"
          styleClass="rounded-button primary-button"
        >
        </p-button>
      </div>
    </ng-template>
  </p-dialog>

  <!-- Enhanced Toast Messages -->
  <p-toast position="top-right" [life]="5000"></p-toast>

  <!-- Enhanced Confirmation Dialog -->
  <p-confirmDialog
    [style]="{ width: '500px' }"
    [baseZIndex]="10000"
    rejectButtonStyleClass="p-button-text p-button-secondary p-button-rounded"
    acceptButtonStyleClass="p-button-primary p-button-rounded"
  >
  </p-confirmDialog>

  <!-- Enhanced Loading Overlay -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="loading-content bg-white border-round shadow-3 p-5">
      <div class="flex flex-column align-items-center">
        <p-progressSpinner
          strokeWidth="3"
          [style]="{ width: '60px', height: '60px' }"
        ></p-progressSpinner>
        <h4 class="mt-3 mb-2 text-900">Procesando...</h4>
        <p class="text-500 m-0">
          Por favor espere mientras procesamos la información
        </p>
      </div>
    </div>
  </div>
</div>